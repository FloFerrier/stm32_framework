cmake_minimum_required(VERSION 3.20)

message(" SELECTED_BOARD : ${SELECTED_BOARD}")

if(SELECTED_BOARD STREQUAL stm32f446re)
	set(CPU "cortex-m4")
	set(FPU "fpv4-sp-d16")
	set(FLOAT_ABI "hard")
	set(LINKER_FILE ${CMAKE_SOURCE_DIR}/config/STM32F446RETX_FLASH.ld)
elseif(SELECTED_BOARD STREQUAL stm32l152re)
	set(CPU "cortex-m3")
	set(FLOAT_ABI "soft")
	set(LINKER_FILE ${CMAKE_SOURCE_DIR}/config/STM32L152RETx_FLASH.ld)
else()
	message(FATAL_ERROR " Selected Board is not supported ...")
endif()

message("Selected Board : ${SELECTED_BOARD}")

project(Openpill)

enable_language(C ASM)
set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_EXTENSIONS OFF)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin)

if(CMAKE_BUILD_TYPE STREQUAL Debug)
	add_subdirectory(Core)
    add_subdirectory(HAL)
	add_subdirectory(OS)
elseif(CMAKE_BUILD_TYPE STREQUAL Release)
	add_subdirectory(Core)
    add_subdirectory(HAL)
	add_subdirectory(OS)
elseif(CMAKE_BUILD_TYPE STREQUAL Test)
	include(CTest)
	set(CMAKE_C_EXTENSIONS ON)
    include(cmake/cmocka.cmake)
	add_subdirectory(Tests)
	message("Test selected. Be careful, binary is generated by a native compiler (no cross-compilation).")
else()
	message(ERROR " Specify CMAKE_BUILD_TYPE as Debug, Release or Test")
endif()